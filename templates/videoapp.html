<html>
<head>
    <style>
        #root {
            width: 100vw;
            height: 100vh;
            position: relative;
            background-color: #2C2C2C; /* A neutral background color for better contrast */
        }
        #captions {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 1.5em;
            background-color: rgba(0, 0, 0, 0.6);
            padding: 10px 20px;
            border-radius: 10px;
            max-width: 90%;
            text-align: center;
            line-height: 1.4;
            letter-spacing: 0.5px;
            font-family: Arial, sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    <div id="captions"></div>

    <script src="https://unpkg.com/@zegocloud/zego-uikit-prebuilt/zego-uikit-prebuilt.js"></script>
    <script>
        window.onload = function () {
            function getUrlParams(url) {
                let urlStr = url.split('?')[1];
                const urlSearchParams = new URLSearchParams(urlStr);
                const result = Object.fromEntries(urlSearchParams.entries());
                return result;
            }

            const roomID = getUrlParams(window.location.href)['roomID'] || (Math.floor(Math.random() * 10000) + "");
            const userID = Math.floor(Math.random() * 10000) + "";
            const userName = "userName" + userID;
            const appID = 155353443;
            const serverSecret = "9320878cdb395bf007e8b6157bf7ad88";
            const kitToken = ZegoUIKitPrebuilt.generateKitTokenForTest(appID, serverSecret, roomID, userID, userName);

            const zp = ZegoUIKitPrebuilt.create(kitToken);
            zp.joinRoom({
                container: document.querySelector("#root"),
                sharedLinks: [{
                    name: 'Personal link',
                    url: window.location.protocol + '//' + window.location.host  + window.location.pathname + '?roomID=' + roomID,
                }],
                scenario: {
                    mode: ZegoUIKitPrebuilt.VideoConference,
                },
                turnOnMicrophoneWhenJoining: false,
                turnOnCameraWhenJoining: false,
                showMyCameraToggleButton: true,
                showMyMicrophoneToggleButton: true,
                showAudioVideoSettingsButton: true,
                showScreenSharingButton: true,
                showTextChat: true,
                showUserList: true,
                maxUsers: 2,
                layout: "Auto",
                showLayoutButton: false,
            });

            // Web Speech API for live captions
            const captionsDiv = document.getElementById("captions");
            const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
            recognition.interimResults = true;
            recognition.continuous = true;

            recognition.onresult = function(event) {
                const transcript = Array.from(event.results)
                    .map(result => result[0])
                    .map(result => result.transcript)
                    .join('');

                // Display only the last few words to mimic subtitle behavior
                const words = transcript.split(' ');
                const lastWords = words.slice(-12).join(' '); // Adjust number to limit text to display
                captionsDiv.textContent = lastWords;

                // Clear caption after a short delay if speech ends
                if (event.results[event.results.length - 1].isFinal) {
                    setTimeout(() => {
                        captionsDiv.textContent = '';
                    }, 3000); // Adjust timing as necessary
                }
            };

            recognition.start();
        }
    </script>
</body>
</html>
